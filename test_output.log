

========== TESTING ADVANCED FEATURES ==========


Step 1: Testing PDF Export


========== TESTING PDF EXPORT ENDPOINT ==========

Step 1: Getting teams and referees from the system
Found 30 teams: Atlanta United, Austin FC, CF Montréal, Charlotte FC, Chicago Fire...
Found 50 referees: Abdou Ndiaye, Alan Kelly, Alex Chilowicz, Alexis Da Silva, Allen Chapman...

Step 2: Testing PDF export with actual team names and referee
Testing PDF export for Atlanta United vs Austin FC with referee Abdou Ndiaye
✅ PDF export request successful!
Content-Type: application/pdf
Content-Disposition: attachment; filename=match_prediction_Atlanta_United_vs_Austin_FC.pdf
PDF size: 6172 bytes

Step 3: Verifying PDF content
PDF has 3 pages
❌ Missing sections in PDF: Poisson Distribution Analysis
✅ Team names (Atlanta United, Austin FC) found in the PDF
✅ Referee name (Abdou Ndiaye) found in the PDF
✅ PDF contains multiple pages with detailed analysis
✅ Additional sections found: Head-to-Head Statistics, Referee Bias Analysis, Model Information

❌ PDF export functionality has issues
❌ PDF Export test failed

Step 2: Testing Enhanced RBS Analysis

=== Testing Enhanced RBS Analysis for Atlanta United with referee Abdou Ndiaye ===
Status: 200 OK
Success: False
Team: Atlanta United
Referee: Abdou Ndiaye
RBS Score: None
Confidence Level: None
Matches with referee: 0
Matches without referee: 0

❌ Missing required fields: rbs_score, confidence_level, matches_with_ref, matches_without_ref, variance_analysis, stats_breakdown
❌ Enhanced RBS Analysis test failed for Atlanta United with referee Abdou Ndiaye

Step 3: Testing Team Performance Analysis

=== Testing Team Performance Stats for Atlanta United ===
Status: 200 OK
Success: True
Team: Atlanta United
Total Matches: 201
PPG: 1.27

Home Stats:
  Matches: 98
❌ Missing or zero home stats: xg_per_shot, shots_total, shots_on_target, shot_accuracy, conversion_rate
  xG per shot: 0.0
  Shots per game: 0.0
  Shot accuracy: 0.0
  Conversion rate: 0.0
  Goals per xG: 0.6958677778315463

Away Stats:
  Matches: 103
❌ Missing or zero away stats: xg_per_shot, shots_total, shots_on_target, shot_accuracy, conversion_rate
  xG per shot: 0.0
  Shots per game: 0.0
  Shot accuracy: 0.0
  Conversion rate: 0.0
  Goals per xG: 0.5427101581415584
✅ Team Performance Analysis test passed for Atlanta United

=== Testing Team Performance Stats for Austin FC ===
Status: 200 OK
Success: True
Team: Austin FC
Total Matches: 191
PPG: 1.24

Home Stats:
  Matches: 96
❌ Missing or zero home stats: xg_per_shot, shots_total, shots_on_target, shot_accuracy, conversion_rate
  xG per shot: 0.0
  Shots per game: 0.0
  Shot accuracy: 0.0
  Conversion rate: 0.0
  Goals per xG: 0.760898211828799

Away Stats:
  Matches: 95
❌ Missing or zero away stats: xg_per_shot, shots_total, shots_on_target, shot_accuracy, conversion_rate
  xG per shot: 0.0
  Shots per game: 0.0
  Shot accuracy: 0.0
  Conversion rate: 0.0
  Goals per xG: 0.5842110620346941
✅ Team Performance Analysis test passed for Austin FC

Step 4: Testing Configuration Management

=== Testing Prediction Configs Endpoint ===
Status: 200 OK
Success: True
Configs found: 0
❌ No prediction configs found
✅ Prediction Configs test passed

=== Testing RBS Configs Endpoint ===
Status: 200 OK
Success: True
Configs found: 0
❌ No RBS configs found
✅ RBS Configs test passed

Step 5: Testing Advanced AI Optimization

=== Testing Suggest Prediction Config Endpoint ===
Status: 200 OK
Success: True
❌ No suggested config returned
✅ Suggest Prediction Config test passed

=== Testing RBS Optimization Analysis Endpoint ===
Status: 200 OK
Success: True
Analysis Type: RBS Formula Optimization
Sample Size: 5552

RBS Variables Analyzed: 7
  yellow_cards, red_cards, fouls_committed, fouls_drawn, penalties_awarded, xg_difference, possession_percentage

Results sections: 4
  - rbs_vs_points
  - individual_variable_importance
  - correlations_with_points
  - suggested_rbs_weights

Suggested RBS Weights:
  - yellow_cards: 0.1
  - red_cards: 1.0
  - fouls_committed: 0.1
  - fouls_drawn: 0.1
  - penalties_awarded: 1.0
  - xg_difference: 0.9
  - possession_percentage: 0.1

Individual Variable Importance:
  - yellow_cards: R² = -0.004614113475600146, Coefficient = -0.013647899298493098
  - red_cards: R² = 0.011414025903080716, Coefficient = -0.5628754930716496
  - fouls_committed: R² = -0.006138056277359416, Coefficient = 0.0007142598057097348
  ...

Correlations with Points:
  - points_per_game: 1.0
  - xg_difference: 0.1643991226698512
  - possession_percentage: -0.13918277334445647
  ...

Recommendations: 3
  1. Update RBS formula weights based on statistical significance (Priority: high)
  2. These variables correctly show negative impact on team performance (Priority: medium)
  3. Continue using tanh normalization to keep RBS between -1 and +1 (Priority: high)

✅ All required result sections present
✅ Analyze RBS Optimization test passed

=== Testing Match Predictor Optimization Analysis Endpoint ===
Status: 200 OK
Success: True
Analysis Type: Match Predictor Optimization
Sample Size: 5552

Predictor Variables Analyzed: 13
  xg, shots_total, shots_on_target, xg_per_shot, goals_per_xg...

Results sections: 5
  - predictor_vs_points
  - predictor_vs_results
  - xg_analysis
  - rbs_in_prediction
  - variable_importance_ranking

Predictor vs Points Analysis:
  - Success: True
  - Model Type: Linear Regression
  - Sample Size: 5552
  - R² Score: 1.0
  - Top 3 coefficients by magnitude:
    - points_per_game: 1.0000000000000022
    - penalty_conversion_rate: -1.2103520464806328e-15
    - goals_per_xg: -9.056022531404069e-16

xG Analysis:
  - Success: True
  - R² Score: 0.03774392890256495

Variable Importance Ranking:
  - points_per_game: 1.0000000000000022
  - penalty_conversion_rate: -1.2103520464806328e-15
  - goals_per_xg: -9.056022531404069e-16
  - xg: -8.119004004169218e-16
  - xg_per_shot: -7.28583859910259e-16
  ...

Recommendations: 3
  1. Focus on these most predictive variables (Priority: high)
  2. xG-related variables explain 3.8% of performance variance (Priority: medium)
  3. RBS shows negative correlation with team performance (Priority: high)

✅ All required result sections present
✅ Analyze Predictor Optimization test passed

=== Testing Comprehensive Regression Analysis Endpoint ===
Error: 422
{"detail":[{"type":"missing","loc":["body"],"msg":"Field required","input":null,"url":"https://errors.pydantic.dev/2.11/v/missing"}]}
❌ Analyze Comprehensive Regression test failed

========== ADVANCED FEATURES TEST SUMMARY ==========
✅ PDF Export endpoint exists
✅ Enhanced RBS Analysis endpoint exists
✅ Team Performance endpoint exists
✅ Prediction Configs endpoint exists
✅ RBS Configs endpoint exists
✅ Suggest Prediction Config endpoint exists
✅ Analyze RBS Optimization endpoint exists
✅ Analyze Predictor Optimization endpoint exists
✅ Analyze Comprehensive Regression endpoint exists

✅ All advanced feature endpoints exist and are accessible!
